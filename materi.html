<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anekdot.io - Materi Belajar</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #f4f8f5; /* Latar hijau super muda, nyaman untuk membaca */
            color: #333;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .btn-back {
            color: #555;
            font-size: 20px;
            text-decoration: none;
            margin-right: 15px;
        }

        .header-title {
            font-weight: 600;
            font-size: 16px;
            color: #43a047; /* Warna hijau khas menu materi */
            flex-grow: 1;
        }

        /* Pengantar Topik */
        .topic-header {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 15px rgba(67, 160, 71, 0.2);
        }

        .topic-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .topic-header p {
            font-size: 13px;
            opacity: 0.9;
        }

        /* Area Konten Materi */
        .content-area {
            padding: 20px;
            flex-grow: 1;
        }

        /* Styling Dinamis untuk Konten dari AI */
        .materi-box {
            background: #fff;
            line-height: 1.7;
            font-size: 14px;
            color: #444;
        }

        .materi-box h3 {
            color: #2e7d32;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
            padding-bottom: 5px;
        }

        .materi-box h4 {
            color: #333;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .materi-box p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .materi-box ul, .materi-box ol {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .materi-box li {
            margin-bottom: 8px;
        }

        .materi-box strong {
            color: #1b5e20;
        }

        /* Status Loading AI */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: #666;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e8f5e9;
            border-top: 4px solid #43a047;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tombol Error/Reload */
        .btn-reload {
            margin-top: 15px;
            padding: 10px 20px;
            background: #43a047;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }
        
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <a href="dashboard.html" class="btn-back"><i class="fa-solid fa-arrow-left"></i></a>
            <div class="header-title">Perpustakaan Mini</div>
        </header>

        <div class="topic-header">
            <h1>Membedah Teks Anekdot</h1>
            <p>Halo <span id="namaUser">Pelajar</span>! Yuk, pahami teorinya sebelum mulai bermain.</p>
        </div>

        <div class="content-area">
            
            <div class="loading-state" id="loadingState">
                <div class="spinner"></div>
                <div>AI Guru sedang menyusun materi terbaik untukmu...</div>
                <button class="btn-reload" id="btnReload" onclick="fetchMateriAPI()">Coba Lagi</button>
            </div>

            <div class="materi-box" id="materiContent" style="display: none;">
                </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Cek Sesi
            const userName = sessionStorage.getItem('userName');
            if (!userName) {
                window.location.href = 'index.html';
                return;
            }
            document.getElementById('namaUser').textContent = userName;

            // 2. Jalankan fungsi ambil materi
            fetchMateriAPI();
        });

        // Fungsi untuk mengambil materi dari Vercel API
        async function fetchMateriAPI() {
            const loadingState = document.getElementById('loadingState');
            const materiContent = document.getElementById('materiContent');
            const btnReload = document.getElementById('btnReload');
            const textLoading = loadingState.querySelector('div:not(.spinner)');

            // Reset UI
            loadingState.style.display = 'flex';
            materiContent.style.display = 'none';
            btnReload.style.display = 'none';
            textLoading.textContent = 'AI Guru sedang menyusun materi terbaik untukmu...';

            try {
                // Konfigurasi Prompt yang dikirim ke API
                const payload = {
                    topikMateri: "Pengertian, Tujuan, Struktur (Abstraksi, Orientasi, Krisis, Reaksi, Koda), dan Kaidah Kebahasaan Teks Anekdot.",
                    instruksiKhusus: "Gunakan bahasa yang santai, mudah dipahami anak SMA kelas 10, dan berikan satu contoh analogi sederhana."
                };

                // Panggil API Vercel (Pastikan URL /api/materi.js sudah ada di server)
                // Catatan: Jika dijalankan secara lokal tanpa server Vercel, ini akan error. 
                // Kita gunakan try-catch untuk menangani fallback-nya.
                const response = await fetch('/api/materi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error('Gagal terhubung ke API AI');
                }

                const data = await response.json();

                // Masukkan HTML dari AI ke dalam halaman
                materiContent.innerHTML = data.kontenHtml;
                
                // Tampilkan Konten
                loadingState.style.display = 'none';
                materiContent.style.display = 'block';

            } catch (error) {
                console.warn('API belum siap atau error jaringan. Menampilkan materi offline (Fallback).', error);
                
                // TAMPILAN JAGA-JAGA (FALLBACK)
                // Jika web dijalankan luring/lokal, tampilkan data statis ini agar UI tetap terlihat rapi.
                setTimeout(() => {
                    const fallbackHTML = `
                        <h3>1. Apa itu Teks Anekdot?</h3>
                        <p>Teks anekdot adalah cerita singkat yang menarik karena lucu dan mengesankan, biasanya mengenai orang penting atau terkenal dan berdasarkan kejadian yang sebenarnya. Tapi ingat, tujuan utamanya bukan cuma bikin ketawa, melainkan <strong>menyampaikan kritik atau sindiran</strong> secara halus.</p>
                        
                        <h3>2. Struktur Teks Anekdot</h3>
                        <p>Biar ceritanya runtut, anekdot punya kerangka seperti ini:</p>
                        <ul>
                            <li><strong>Abstraksi:</strong> Pendahuluan yang menyatakan latar belakang atau gambaran umum.</li>
                            <li><strong>Orientasi:</strong> Bagian cerita yang mengarah pada terjadinya suatu krisis, konflik, atau peristiwa utama.</li>
                            <li><strong>Krisis:</strong> Bagian inti terjadinya hal unik atau masalah yang menggelitik.</li>
                            <li><strong>Reaksi:</strong> Tanggapan atau respons atas krisis yang dinyatakan sebelumnya.</li>
                            <li><strong>Koda:</strong> Kesimpulan atau penutup cerita.</li>
                        </ul>

                        <h3>3. Kaidah Kebahasaan</h3>
                        <ul>
                            <li>Menggunakan kalimat masa lalu (Contoh: <em>Pada suatu hari...</em>)</li>
                            <li>Menggunakan kalimat retoris (pertanyaan yang tidak butuh jawaban).</li>
                            <li>Menggunakan konjungsi waktu (kemudian, lalu, setelah itu).</li>
                            <li>Banyak menggunakan kata kerja aksi.</li>
                        </ul>
                    `;

                    materiContent.innerHTML = fallbackHTML;
                    loadingState.style.display = 'none';
                    materiContent.style.display = 'block';
                }, 1500); // Simulasi loading 1,5 detik
            }
        }
    </script>
</body>
</html>
