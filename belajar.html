<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anekdot.io - Kartu Belajar</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        /* Latar Belakang Pastel Animasi Tipis */
        body { 
            /* Gradasi 4 warna pastel yang lembut */
            background: linear-gradient(-45deg, #ffecd2, #fcb69f, #a1c4fd, #c2e9fb);
            background-size: 400% 400%;
            animation: pastelGradient 15s ease infinite;
            color: #333; 
            min-height: 100vh; 
        }

        @keyframes pastelGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Container ala Glassmorphism (Kaca Buram) */
        .app-container {
            width: 100%; max-width: 480px; margin: 0 auto; min-height: 100vh;
            background: rgba(255, 255, 255, 0.75); /* Semi Transparan */
            backdrop-filter: blur(15px); /* Efek Kaca Buram */
            box-shadow: 0 0 30px rgba(0,0,0,0.05);
            position: relative; display: flex; flex-direction: column; overflow-x: hidden;
        }

        /* HEADER */
        header {
            background: rgba(255, 255, 255, 0.6); padding: 15px 20px; display: flex; align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3); position: sticky; top: 0; z-index: 10;
        }
        .btn-back { color: #555; font-size: 20px; text-decoration: none; margin-right: 15px; transition: 0.3s;}
        .btn-back:hover { color: #2575fc; transform: translateX(-3px); }
        .header-title { font-weight: 700; font-size: 16px; color: #2575fc; flex-grow: 1; }
        .poin-badge {
            background: linear-gradient(135deg, #ffb300, #f59e0b); color: #fff; padding: 6px 15px;
            border-radius: 20px; font-size: 13px; font-weight: 700;
            display: flex; align-items: center; gap: 5px; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
        }

        /* MATERI BERJALAN (TYPEWRITER) */
        .intro-section { padding: 15px 20px; }
        .intro-box {
            background: rgba(255, 255, 255, 0.85); border: 1px solid rgba(255, 255, 255, 0.5); 
            border-radius: 15px; padding: 15px; position: relative; min-height: 90px;
            display: flex; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.02);
        }
        .intro-box::before {
            content: "\f0eb"; font-family: "Font Awesome 6 Free"; font-weight: 900;
            position: absolute; top: -10px; left: 15px; background: #2575fc; color: #fff;
            width: 24px; height: 24px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 12px;
            box-shadow: 0 2px 5px rgba(37, 117, 252, 0.3);
        }
        .intro-text { font-size: 13px; color: #444; line-height: 1.6; font-weight: 500; }
        .cursor { display: inline-block; width: 3px; background-color: #2575fc; animation: blink 1s infinite; margin-left: 2px;}
        @keyframes blink { 50% { opacity: 0; } }

        /* BANNER HUMOR BERGERAK */
        .humor-banner {
            width: 100%; padding: 10px 0; color: white; font-weight: 600; font-size: 13px;
            background: linear-gradient(-45deg, #ff4757, #ff6b81, #2575fc, #6a11cb);
            background-size: 400% 400%; animation: gradientBG 5s ease infinite;
            overflow: hidden; position: relative; white-space: nowrap; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .humor-text { display: inline-block; animation: marquee 10s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100vw); } 100% { transform: translateX(-150%); } }

        /* AREA GAME */
        .game-area { padding: 20px; display: none; flex-direction: column; align-items: center; flex-grow: 1; }

        /* KARTU FULL GAMBAR (PREMIUM 3D FLIP) */
        .card-container {
            width: 100%; max-width: 260px; height: 380px; 
            perspective: 1500px; margin: 0 auto 20px;
        }
        .card-inner {
            width: 100%; height: 100%; position: relative;
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform-style: preserve-3d;
        }
        .card-container:hover .card-inner:not(.is-flipped) {
            transform: scale(1.02) translateY(-5px); 
        }
        .card-inner.is-flipped { transform: rotateY(180deg) scale(1); }

        .card-front, .card-back {
            width: 100%; height: 100%; position: absolute;
            backface-visibility: hidden; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15); overflow: hidden;
            background: #fff; border: 3px solid #fff;
        }
        .card-back { transform: rotateY(180deg); border-color: #4caf50; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }

        /* KOTAK PERTANYAAN DI BAWAH KARTU */
        .question-box {
            background: rgba(255, 255, 255, 0.9); border: 2px solid rgba(255,255,255,0.6); 
            border-radius: 15px; padding: 15px; text-align: center; font-size: 14px; font-weight: 600;
            color: #333; margin-bottom: 20px; width: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); line-height: 1.5;
        }

        /* INPUT & TOMBOL MODERN */
        .input-area { width: 100%; display: flex; flex-direction: column; gap: 12px; }
        .input-jawab {
            width: 100%; padding: 16px; border: 2px solid rgba(226, 232, 240, 0.8); border-radius: 15px;
            font-size: 16px; text-align: center; outline: none; text-transform: uppercase; 
            transition: all 0.3s ease; font-weight: 600; color: #1e293b; background: rgba(248, 250, 252, 0.8);
        }
        .input-jawab:focus { border-color: #2575fc; background: #fff; box-shadow: 0 0 0 4px rgba(37, 117, 252, 0.1); }
        
        .btn-kirim {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #2575fc, #3b82f6);
            color: white; border: none; border-radius: 15px; font-size: 16px; font-weight: 700;
            cursor: pointer; box-shadow: 0 8px 20px rgba(37, 117, 252, 0.3); transition: 0.3s;
        }
        .btn-kirim:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(37, 117, 252, 0.4); }

        .feedback-msg { text-align: center; font-size: 14px; font-weight: 700; margin-top: 10px; min-height: 20px;}
        .msg-error { color: #ef4444; }
        .msg-success { color: #10b981; }

        .extra-controls { display: none; width: 100%; gap: 12px; margin-top: 15px; }
        .btn-outline, .btn-next { flex: 1; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; font-size: 14px; transition: 0.2s;}
        .btn-outline { background: rgba(255,255,255,0.8); border: 2px solid #cbd5e1; color: #64748b; }
        .btn-outline:hover { border-color: #94a3b8; color: #334155; }
        .btn-next { background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3); }
        .btn-next:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4); }

        /* FOOTER PATEN */
        .footer-area {
            background: rgba(255, 255, 255, 0.5); text-align: center; padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.4); margin-top: auto;
        }
        .footer-links a { color: #64748b; text-decoration: none; font-size: 12px; font-weight: 600; margin: 0 10px; transition: 0.2s; }
        .footer-links a:hover { color: #2575fc; }
        .copyright { font-size: 11px; color: #94a3b8; margin-top: 5px;}

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-box {
            background: #fff; padding: 30px; border-radius: 25px;
            max-width: 320px; width: 90%; text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-box i { font-size: 60px; color: #ffb300; margin-bottom: 15px; }
        .btn-modal {
            background: #2575fc; color: #fff; border: none; padding: 14px 30px;
            border-radius: 15px; font-weight: 700; margin-top: 20px; cursor: pointer; width: 100%;
        }

        .loading-data { text-align: center; padding: 100px 20px; color: #2575fc; font-weight: 600;}
    </style>
</head>
<body>

    <div class="app-container">
        <header>
            <a href="dashboard.html" class="btn-back"><i class="fa-solid fa-arrow-left"></i></a>
            <div class="header-title">Kartu Belajar</div>
            <div class="poin-badge">
                <i class="fa-solid fa-star"></i> <span id="skorUser">0</span>
            </div>
        </header>

        <section class="intro-section">
            <div class="intro-box">
                <div class="intro-text"><span id="materiText"></span><span class="cursor"></span></div>
            </div>
        </section>

        <div class="humor-banner">
            <div class="humor-text" id="humorText">Ayo jawab dengan benar, jangan sampai otakmu ikutan nge-blank!</div>
        </div>

        <div class="loading-data" id="loadingData">
            <i class="fa-solid fa-spinner fa-spin fa-2x"></i><br><br>Menarik kartu dari server...
        </div>

        <section class="game-area" id="gameArea">
            <div class="card-container">
                <div class="card-inner" id="flashcard">
                    <div class="card-front">
                        <img src="" id="imgDepan" class="card-img" alt="Soal">
                    </div>
                    <div class="card-back">
                        <img src="" id="imgBelakang" class="card-img" alt="Jawaban">
                    </div>
                </div>
            </div>

            <div class="question-box" id="teksSoal">Memuat soal...</div>

            <div class="input-area" id="areaInput">
                <input type="text" id="inputJawab" class="input-jawab" placeholder="Ketik jawaban di sini..." autocomplete="off">
                <button class="btn-kirim" id="btnKirim">Kunci Jawaban</button>
            </div>
            
            <div class="feedback-msg" id="pesanFeedback"></div>
            
            <div class="extra-controls" id="areaKontrolLanjut">
                <button class="btn-outline" id="btnBalikKartu"><i class="fa-solid fa-rotate"></i> Putar Kartu</button>
                <button class="btn-next" id="btnNext">Lanjut <i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </section>

        <div class="footer-area">
            <div class="footer-links">
                <a href="privasi.html">Kebijakan Privasi</a> •
                <a href="privasi.html">Kredit</a>
            </div>
            <div class="copyright">© 2026 Anekdot.io by Cendekia Aksara</div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <i class="fa-solid fa-trophy"></i>
            <h3 style="margin-bottom: 5px;">Luar Biasa!</h3>
            <p style="font-size: 13px; color:#666;">Semua tumpukan kartu sudah kamu selesaikan. Mau kita acak lagi dari awal?</p>
            <button class="btn-modal" id="btnTutupModal">Main Lagi!</button>
        </div>
    </div>

    <audio id="soundBenar" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3" preload="auto"></audio>
    <audio id="soundSalah" src="https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3" preload="auto"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhLMOes8_bVkE22fh2a_pQWiytG3RZY0Q",
            authDomain: "juararc-503f9.firebaseapp.com",
            projectId: "juararc-503f9",
            storageBucket: "juararc-503f9.firebasestorage.app",
            messagingSenderId: "306187241171",
            appId: "1:306187241171:web:70285c8b2643acd0533626"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // VARIABEL MATERI (10 Paragraf)
        const materiArray = [
            "Teks anekdot adalah cerita singkat yang menarik karena lucu dan mengesankan.",
            "Biasanya anekdot menceritakan orang penting atau figur publik berdasarkan kejadian nyata.",
            "Tujuan utama teks anekdot bukanlah sekadar hiburan, melainkan untuk menyindir atau mengkritik.",
            "Struktur pertama adalah Abstraksi, yaitu bagian awal yang memberikan gambaran umum cerita.",
            "Kedua, Orientasi. Bagian ini menunjukkan latar belakang bagaimana peristiwa utama terjadi.",
            "Ketiga, Krisis. Ini adalah inti cerita tempat terjadinya hal unik atau masalah yang menggelitik.",
            "Keempat, Reaksi. Bagian yang berisi tanggapan atau respons atas krisis yang terjadi sebelumnya.",
            "Kelima, Koda. Merupakan penutup atau kesimpulan dari cerita anekdot.",
            "Anekdot sering menggunakan pertanyaan retoris, yaitu pertanyaan yang tidak membutuhkan jawaban.",
            "Anekdot juga banyak menggunakan kata kerja aksi dan konjungsi yang menyatakan urutan waktu."
        ];

        // VARIABEL HUMOR BANNER
        const humorArray = [
            "Ayo fokus! Jangan sampai ingatanmu hilang kayak janji politisi pas kampanye.",
            "Dijawab yang bener ya, masa kalah sama anak SD yang lagi ujian matematika?",
            "Santai tapi pasti. Nggak usah buru-buru, yang penting poinnya masuk!",
            "Kalau salah jangan nangis, cukup tarik napas dan coba lagi.",
            "Ayo buktikan kamu lebih cerdas dari AI yang bikin sistem ini!"
        ];

        let bankSoal = [];
        let soalTersedia = [];
        let soalSaatIni = null;
        let skor = parseInt(sessionStorage.getItem('skorLocal')) || 0; 
        const userID = sessionStorage.getItem('userID');
        let userDocRef = null;

        const loadingData = document.getElementById('loadingData');
        const gameArea = document.getElementById('gameArea');
        const flashcard = document.getElementById('flashcard');
        const teksSoal = document.getElementById('teksSoal');
        const inputJawab = document.getElementById('inputJawab');
        const btnKirim = document.getElementById('btnKirim');
        const pesanFeedback = document.getElementById('pesanFeedback');
        const areaInput = document.getElementById('areaInput');
        const areaKontrolLanjut = document.getElementById('areaKontrolLanjut');
        const skorElement = document.getElementById('skorUser');
        const modalOverlay = document.getElementById('modalOverlay');
        
        // Element Audio
        const soundBenar = document.getElementById('soundBenar');
        const soundSalah = document.getElementById('soundSalah');

        // FUNGSI ANIMASI TYPEWRITER MATERI
        let materiIndex = 0;
        let charIndex = 0;
        let currentText = "";
        const materiEl = document.getElementById('materiText');

        function typeWriter() {
            if (charIndex < materiArray[materiIndex].length) {
                currentText += materiArray[materiIndex].charAt(charIndex);
                materiEl.innerHTML = currentText;
                charIndex++;
                setTimeout(typeWriter, 50);
            } else {
                setTimeout(hapusWriter, 8000); 
            }
        }

        function hapusWriter() {
            materiIndex = (materiIndex + 1) % materiArray.length;
            currentText = "";
            charIndex = 0;
            typeWriter();
        }

        // FUNGSI ROTASI HUMOR BANNER
        let humorIndex = 0;
        const humorEl = document.getElementById('humorText');
        setInterval(() => {
            humorIndex = (humorIndex + 1) % humorArray.length;
            humorEl.textContent = humorArray[humorIndex];
        }, 10000); 

        async function init() {
            if (!userID) { window.location.href = 'index.html'; return; }
            skorElement.textContent = skor;
            typeWriter(); 
            
            try {
                const qUser = query(collection(db, "users_session"), where("userID", "==", userID));
                const userSnap = await getDocs(qUser);
                if (!userSnap.empty) userDocRef = userSnap.docs[0].ref;

                const soalSnap = await getDocs(collection(db, "bank_soal_belajar"));
                soalSnap.forEach(doc => bankSoal.push(doc.data()));
                
                if (bankSoal.length === 0) {
                    loadingData.innerHTML = "Belum ada soal dari Admin.";
                    return;
                }

                soalTersedia = [...bankSoal];
                loadingData.style.display = 'none';
                gameArea.style.display = 'flex';
                tampilkanSoalBaru();
            } catch (e) {
                loadingData.innerHTML = "Koneksi Error.";
            }
        }

        function tampilkanSoalBaru() {
            if (soalTersedia.length === 0) {
                modalOverlay.style.display = 'flex';
                soalTersedia = [...bankSoal];
                return;
            }

            const idx = Math.floor(Math.random() * soalTersedia.length);
            soalSaatIni = soalTersedia[idx];
            soalTersedia.splice(idx, 1);

            document.getElementById('imgDepan').src = soalSaatIni.imgDepan;
            document.getElementById('imgBelakang').src = soalSaatIni.imgBelakang;
            
            teksSoal.innerHTML = `<strong>Pertanyaan:</strong><br>${soalSaatIni.pertanyaan}`;

            flashcard.classList.remove('is-flipped');
            inputJawab.value = '';
            pesanFeedback.innerHTML = '';
            areaInput.style.display = 'flex';
            areaKontrolLanjut.style.display = 'none';
        }

        btnKirim.onclick = async () => {
            const jUser = inputJawab.value.trim().toUpperCase();
            const jAsli = soalSaatIni.jawaban.trim().toUpperCase();

            if (!jUser) { 
                pesanFeedback.innerHTML = '<span class="msg-error" style="animation: none;"><i class="fa-solid fa-triangle-exclamation"></i> Diisi dulu dong jawabannya!</span>'; 
                return; 
            }

            if (jUser === jAsli) {
                // --- JAWABAN BENAR ---
                pesanFeedback.innerHTML = '<span class="msg-success"><i class="fa-solid fa-circle-check"></i> Luar Biasa! Jawaban Tepat.</span>';
                
                soundBenar.currentTime = 0;
                soundBenar.play().catch(e => console.log(e));
                
                confetti({
                    particleCount: 150,
                    spread: 80,
                    origin: { y: 0.6 },
                    colors: ['#2575fc', '#4caf50', '#ffb300', '#ff4757']
                });

                skor += 10;
                skorElement.textContent = skor;
                sessionStorage.setItem('skorLocal', skor);
                if (userDocRef) updateDoc(userDocRef, { skor: skor });

                teksSoal.innerHTML = `<span style="color:#10b981;"><strong>Kunci Jawaban:</strong><br>${soalSaatIni.jawaban}</span>`;

                flashcard.classList.add('is-flipped');
                areaInput.style.display = 'none';
                areaKontrolLanjut.style.display = 'flex';
                
            } else {
                // --- JAWABAN SALAH ---
                pesanFeedback.innerHTML = '<span class="msg-error"><i class="fa-solid fa-xmark"></i> Kurang tepat. Coba cek lagi!</span>';
                
                // Mainkan suara Tetot
                soundSalah.currentTime = 0;
                soundSalah.play().catch(e => console.log(e));

                // Fitur Getar Haptic (Akan bergetar 300ms, jeda 100ms, bergetar 300ms)
                if ("vibrate" in navigator) {
                    navigator.vibrate([300, 100, 300]);
                }

                // Efek Animasi Goyang (Shake) pada form input
                inputJawab.style.transform = "translateX(-10px)";
                setTimeout(() => inputJawab.style.transform = "translateX(10px)", 100);
                setTimeout(() => inputJawab.style.transform = "translateX(-10px)", 200);
                setTimeout(() => inputJawab.style.transform = "translateX(0)", 300);
            }
        };

        document.getElementById('btnNext').onclick = tampilkanSoalBaru;
        document.getElementById('btnBalikKartu').onclick = () => {
            flashcard.classList.toggle('is-flipped');
        };
        document.getElementById('btnTutupModal').onclick = () => {
            modalOverlay.style.display = 'none';
            tampilkanSoalBaru();
        };

        inputJawab.oninput = () => inputJawab.value = inputJawab.value.toUpperCase();

        init();
    </script>
</body>
</html>
